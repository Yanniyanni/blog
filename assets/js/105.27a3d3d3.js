(window.webpackJsonp=window.webpackJsonp||[]).push([[105],{510:function(t,s,a){"use strict";a.r(s);var e=a(48),l=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"大文件上传"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#大文件上传"}},[t._v("#")]),t._v(" 大文件上传")]),t._v(" "),a("h3",{attrs:{id:"上传问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#上传问题"}},[t._v("#")]),t._v(" 上传问题")]),t._v(" "),a("ul",[a("li",[t._v("等待时间长、超时")]),t._v(" "),a("li",[t._v("重新上传需要再次等待")])]),t._v(" "),a("p",[t._v("其他问题：")]),t._v(" "),a("p",[t._v("海外部署，国内访问慢，需要解决cdn回流？")]),t._v(" "),a("h3",{attrs:{id:"解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[t._v("#")]),t._v(" 解决方案")]),t._v(" "),a("p",[t._v("| 应该限制一下文件大小，不能上传几个G，这样占用服务器资源\n| 手动压缩一下文件\n| 在线文件服务：cdn、aws-s3")]),t._v(" "),a("ul",[a("li",[t._v("分片上传\nJavaScript 中，文件 File 对象是 Blob 对象的子类，Blob 对象包含一个重要的方法 slice，通过这个方法，我们就可以对二进制文件进行拆分，返回一个chunkList，给chunkList的每一个分片设置一定顺序标识partNumber，所有都发送完成之后，前端发送 complete 请求，后端接收后把文件重新拼起来，然后返回文件信息。")])]),t._v(" "),a("p",[t._v("function createFileChunk(file, size = SIZE) {\nconst fileChunkList = []\nlet cur = 0\nwhile (cur < file.size) {\nfileChunkList.push({\nfile: file.slice(cur, cur + size),\n})\ncur += size\n}\nreturn fileChunkList\n}")]),t._v(" "),a("ul",[a("li",[t._v("断点续传（基于分片上传方案）")])]),t._v(" "),a("p",[t._v("当断网或者暂停的时候会停止后面的上传，重新点击上传之后，再把没上传的部分继续上传")]),t._v(" "),a("ul",[a("li",[t._v("文件秒传\n后端对于文件做缓存，前端解析文件MD5，发送给后端，如果已上传，则后端返回已上传对应的文件信息，前端处理上传组件状态为已上传。")])]),t._v(" "),a("p",[t._v("使用插件：spark-md5")]),t._v(" "),a("p",[t._v("就算修改了文件名字，文件的md5也不会变，是唯一的。")]),t._v(" "),a("ul",[a("li",[t._v("最小化窗口，记录状态，缩小上传窗口")])]),t._v(" "),a("h3",{attrs:{id:"成熟的框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#成熟的框架"}},[t._v("#")]),t._v(" 成熟的框架")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("uppy - aws3")])]),t._v(" "),a("li",[a("p",[t._v("阿里oss 这种，可以直接连接上传，但更多时候本地服务器也需要做逻辑处理/存储一份，所以还是会调接口上传，由接口连接oss")])])]),t._v(" "),a("p",[t._v("https://help.aliyun.com/zh/oss/user-guide/how-to-upload-large-objects-to-oss")]),t._v(" "),a("h2",{attrs:{id:"大文件下载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#大文件下载"}},[t._v("#")]),t._v(" 大文件下载")]),t._v(" "),a("h3",{attrs:{id:"存在问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存在问题"}},[t._v("#")]),t._v(" 存在问题")]),t._v(" "),a("ul",[a("li",[t._v("超时")])]),t._v(" "),a("h3",{attrs:{id:"解决方案-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方案-2"}},[t._v("#")]),t._v(" 解决方案")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("常规下载")]),t._v(" "),a("ul",[a("li",[t._v("window.open('url', '_blank');")]),t._v(" "),a("li",[t._v("a 标签")]),t._v(" "),a("li",[t._v("接口返回文件刘，前端window.URL.createObjectURL 解析出下载地址，再用 a 标签下载")])])]),t._v(" "),a("li",[a("p",[t._v("大文件下载")]),t._v(" "),a("ul",[a("li",[t._v("断点续传下载，也是通过记录Checkpoint，已传输的分片缓存，记录传输位置，下次请求发送记录位置，接口返回对应文件信息 。阿里oss 支持 断点续传下载")])])]),t._v(" "),a("li",[a("p",[t._v("批量下载\n1、后端处理，选取多个文件url，请求接口，接口打包成一个zip，缺点：接口容易超时\n2、前端处理，根据url请求文件，转成成 Blob对象，再打包成zip，缺点：js容易阻塞，界面卡顿\n1. 根据url请求图片，响应类型设置为blob\n2. 获取到文件列表，使用 jszip 插件，写入zip 文件夹中\n3. 调用 file-saver 的 saveAs 方法保存到本地")])])])])}),[],!1,null,null,null);s.default=l.exports}}]);