(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{440:function(t,a,s){"use strict";s.r(a);var e=s(48),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[t._v("#")]),t._v(" 介绍")]),t._v(" "),s("p",[t._v("缓存是一种保存资源副本并在下次请求时直接使用该副本的技术。它有以下几个优点：")]),t._v(" "),s("ul",[s("li",[t._v("改善冗余数据传输（重复请求）")]),t._v(" "),s("li",[t._v("缓解网络瓶颈（带宽限制）")]),t._v(" "),s("li",[t._v("减少瞬间拥塞（多人同时访问）")]),t._v(" "),s("li",[t._v("降低距离时延（距离造成的响应慢）")])]),t._v(" "),s("p",[t._v("通过复用以前获取的资源，可以显著提高网站和应用程序的性能，让响应变得更快。缓存不是必须的，但是设置合适的缓存策略很有必要。")]),t._v(" "),s("blockquote",[s("p",[t._v("一个字总结：快！")])]),t._v(" "),s("h2",{attrs:{id:"命中与未命中"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#命中与未命中"}},[t._v("#")]),t._v(" 命中与未命中")]),t._v(" "),s("p",[t._v("缓存主要是针对 "),s("code",[t._v("GET")]),t._v(" 请求。对于到达缓存的请求，如果有副本可使用，则称为 “缓存命中” ，反之则称为 “缓存未命中”。")]),t._v(" "),s("ul",[s("li",[t._v("缓存命中率：由缓存提供服务的请求所占的比例（对于中等web服务，40%就比较合理了）")]),t._v(" "),s("li",[t._v("字节命中率：缓存提供的字节在传输的所有字节中所占的比例")])]),t._v(" "),s("blockquote",[s("p",[t._v("实际上，HTTP 本身没有提供手段来区分响应式缓存命中的、但客户端提供了。\n客户端通过 Date 和 Age 首部来检测该响应是否是缓存。在谷歌上的表现是 from disk cache 或 from memory cache。")])]),t._v(" "),s("h2",{attrs:{id:"缓存的拓扑结构"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓存的拓扑结构"}},[t._v("#")]),t._v(" 缓存的拓扑结构")]),t._v(" "),s("p",[t._v("缓存可以分为：")]),t._v(" "),s("ul",[s("li",[t._v("私有缓存 （浏览器）：私有缓存只能用于单独用户，如浏览器缓存。")]),t._v(" "),s("li",[t._v("公有代理缓存 （代理服务器）：共享缓存可以被多个用户使用，如代理缓存服务器。")])]),t._v(" "),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-proxy.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-proxy.png")}})]),t._v(" "),s("p",[t._v("根据不同的缓存需求，缓存可以做层次结构，也可以做网状结构的代理，网状结构会更加复杂。")]),t._v(" "),s("blockquote",[s("p",[t._v("由于每个拦截代理都会添加一些性能损耗，所以代理层级不适合太深，一般两到三个代理比较适合。")])]),t._v(" "),s("h2",{attrs:{id:"缓存处理步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓存处理步骤"}},[t._v("#")]),t._v(" 缓存处理步骤")]),t._v(" "),s("p",[t._v("web 缓存对于一条 HTTP GET报文的基本缓存处理过程包括7个步骤：")]),t._v(" "),s("ol",[s("li",[s("strong",[t._v("接收")]),t._v(" —— 从网络中读取抵达的请求报文")]),t._v(" "),s("li",[s("strong",[t._v("解析")]),t._v(" —— 对报文进行解析，提取出 URL 和各种首部")]),t._v(" "),s("li",[s("strong",[t._v("查询")]),t._v(" — —查看本地是否有副本可用，没有则获取一份并保存在本地")]),t._v(" "),s("li",[s("strong",[t._v("新鲜度检测")]),t._v(" —— 查看已缓存副本是否足够新鲜，如果不是，则询问服务器是否有更新")]),t._v(" "),s("li",[s("strong",[t._v("创建响应")]),t._v(" —— 用新的首部和已缓存的主体来构建响应报文")]),t._v(" "),s("li",[s("strong",[t._v("发送")]),t._v(" —— 通过网络将响应发回给客户端")]),t._v(" "),s("li",[s("strong",[t._v("日志")]),t._v(" —— 日志记录（可选）")])]),t._v(" "),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-process-step.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-process-step.png")}})]),t._v(" "),s("h2",{attrs:{id:"缓存控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓存控制"}},[t._v("#")]),t._v(" 缓存控制")]),t._v(" "),s("p",[t._v("与缓存相关的规则信息，均包含在 header 中。无论是 web 脚本文件、浏览器、服务器都可以设置这些 header，使用合适的缓存策略。")]),t._v(" "),s("ul",[s("li",[t._v("Cache-Control")]),t._v(" "),s("li",[t._v("expires")]),t._v(" "),s("li",[t._v("IF-Modified-Since:"),s("code",[t._v("<date>")]),t._v(" + Last-Modified")]),t._v(" "),s("li",[t._v("If-None-Match:"),s("code",[t._v("ETag")]),t._v(" + ETag")])]),t._v(" "),s("blockquote",[s("p",[t._v("expires 是属于 HTTP/1.0 的，使用 expires 设置固定过期时间的缓存策略已经不适用现在的缓存需求，加上大部分浏览器默认的协议是 HTTP/1.1，所以默认使用的都是 Cache-Control。")])]),t._v(" "),s("h3",{attrs:{id:"优先级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优先级"}},[t._v("#")]),t._v(" 优先级")]),t._v(" "),s("p",[t._v("当同时存在各种缓存头的时候，会遵循以下优先级：")]),t._v(" "),s("ul",[s("li",[t._v("强缓存 > 对比缓存")]),t._v(" "),s("li",[t._v("cache-control > expires")]),t._v(" "),s("li",[t._v("ETag > Last-Modified")]),t._v(" "),s("li",[t._v("Pragma > cache-control")])]),t._v(" "),s("blockquote",[s("p",[t._v("Pragma 属于 HTTP1.0 内容。在 HTTP/1.1 中，为了兼容，定义了唯一的使用方式 pragma: no-cache ，作用跟 Cache-Control:no-cache 一样。如果所有的中间服务器都是  HTTP/1.1 则只要设置 Cache-Control:no-cache 即可。")])]),t._v(" "),s("h2",{attrs:{id:"新鲜度检测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新鲜度检测"}},[t._v("#")]),t._v(" 新鲜度检测")]),t._v(" "),s("p",[t._v("如果本地已有副本，缓存都需要进行新鲜度检测。新鲜度检测主要有两个机制：")]),t._v(" "),s("ul",[s("li",[t._v("文档过期（document expiration）")]),t._v(" "),s("li",[t._v("服务器再验证（server revalidation）")])]),t._v(" "),s("p",[t._v("通过这两个检测判断是从缓存读取数据，还是从服务器读取数据。")]),t._v(" "),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-check.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-check.png")}})]),t._v(" "),s("h2",{attrs:{id:"_1-文档过期检测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-文档过期检测"}},[t._v("#")]),t._v(" 1.文档过期检测")]),t._v(" "),s("p",[t._v("通过 "),s("code",[t._v("Cache-Control")]),t._v(" 和 "),s("code",[t._v("expires")]),t._v(" 首部设置过期时间，如果没有其他阻止提供已缓存或未认证资源的首部时，缓存可以任意使用这些副本。")]),t._v(" "),s("h3",{attrs:{id:"cache-control"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cache-control"}},[t._v("#")]),t._v(" Cache-Control")]),t._v(" "),s("p",[t._v("Cache-Control 是通用消息头字段，被用于 http 请求和响应中，通过指定指令来实现缓存机制。缓存指令是单向的，这意味着在请求中设置的指令，不一定被包含在响应中.")]),t._v(" "),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-control.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-control.png")}})]),t._v(" "),s("p",[t._v("关于 Cache-Control 的详细介绍，请看 "),s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Cache-Control",target:"_blank",rel:"noopener noreferrer"}},[t._v("《MDN - Cache-Control》"),s("OutboundLink")],1)]),t._v(" "),s("p",[s("strong",[t._v("常用 Cache-Control")])]),t._v(" "),s("p",[t._v("private、public、no-cache、max-age，no-store，默认是 private。")]),t._v(" "),s("ul",[s("li",[t._v("禁止缓存")])]),t._v(" "),s("div",{staticClass:"language-http line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Cache-Control:")]),t._v(" no-store\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("缓存静态资源")])]),t._v(" "),s("div",{staticClass:"language-http line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Cache-Control:")]),t._v("public, max-age=31536000\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("需要重新验证")])]),t._v(" "),s("div",{staticClass:"language-http line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[t._v("# 不使用缓存，强制向服务器重新请求数据\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Cache-Control:")]),t._v(" no-cache\n# 向服务器发起再验证请求，检测文档的新鲜度\n"),s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("Cache-Control:")]),t._v(" max-age=0\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),t._v(" "),s("h2",{attrs:{id:"_2-服务器再验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务器再验证"}},[t._v("#")]),t._v(" 2.服务器再验证")]),t._v(" "),s("p",[t._v("验证是客户端和服务器的标识进行匹配的过程，也就是说，客户端的请求头会携带一个标识，服务器的响应头会携带一个标识，它们是对应的。")]),t._v(" "),s("p",[t._v("每次的再验证都可能出现以下的结果：")]),t._v(" "),s("ul",[s("li",[t._v("内容发生变化（缓存未命中） =》获取新内容，返回完整的首部和实体数据 =》 状态码：200")]),t._v(" "),s("li",[t._v("内容未变化（缓存命中） =》"),s("strong",[t._v("仅返回新的首部和过期日期")]),t._v(" =》 "),s("strong",[t._v("状态码：304")])]),t._v(" "),s("li",[t._v("内容被删除 =》状态码：404 =》 缓存删除副本")])]),t._v(" "),s("blockquote",[s("p",[t._v("成功的再验证是比缓存未命中更快的，因为再验证成功只需要返回一条 304 的响应和新的首部，并不会发送实体数据。")])]),t._v(" "),s("h3",{attrs:{id:"date日期再验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#date日期再验证"}},[t._v("#")]),t._v(" Date日期再验证")]),t._v(" "),s("ul",[s("li",[t._v("请求头：IF-Modified-Since:"),s("code",[t._v("<date>")]),t._v("（也称为 IMS 请求）")]),t._v(" "),s("li",[t._v("响应头：Last-Modified："),s("code",[t._v("<date>")])])]),t._v(" "),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-last-modified.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-last-modified.png")}})]),t._v(" "),s("h3",{attrs:{id:"etag实体标签再验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#etag实体标签再验证"}},[t._v("#")]),t._v(" ETag实体标签再验证")]),t._v(" "),s("ul",[s("li",[t._v("请求头：If-None-Match:"),s("code",[t._v("ETag")])]),t._v(" "),s("li",[t._v("响应头：ETag："),s("code",[t._v("ETag")])])]),t._v(" "),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-etag.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-etag.png")}})]),t._v(" "),s("p",[s("strong",[t._v("强弱校验")])]),t._v(" "),s("p",[t._v('使用 ETag 方法验证时，还可以区分为"强校验"和"弱校验"')]),t._v(" "),s("ul",[s("li",[t._v("强检验：只要内容发生了改变，强验证器就会变化")])]),t._v(" "),s("div",{staticClass:"language-http line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("etag:")]),t._v(' "5de485b2-ff14"\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("ul",[s("li",[t._v("弱校验（弱Etag）：文件主体修改才验证，如注释的调整等则不会，标识是前缀会有 "),s("code",[t._v("W/")])])]),t._v(" "),s("div",{staticClass:"language-http line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-http"}},[s("code",[s("span",{pre:!0,attrs:{class:"token header-name keyword"}},[t._v("etag:")]),t._v(' W/"b76dfd8b2c82dda6be9e3541d5e8df84"\n')])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("h3",{attrs:{id:"优先级-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#优先级-2"}},[t._v("#")]),t._v(" 优先级")]),t._v(" "),s("p",[t._v("从上面的图中可以看出 Last-Modified 和 ETag 经常会同时出现。如果同时使用了，它们的优先级如下：")]),t._v(" "),s("p",[s("strong",[t._v("ETag > Last-Modified")])]),t._v(" "),s("h3",{attrs:{id:"小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),s("p",[t._v("总结下就是，在文档过期时间内，都会读取缓存数据，这种也被称为 "),s("strong",[t._v('"强缓存"')]),t._v("。如果文档已过期或者有其他要求再验证时（如 Cache-Control: no-cache），就进入了服务器再验证环节，这时就称为 "),s("strong",[t._v('"对比缓存"')]),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"缓存数据的存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缓存数据的存储"}},[t._v("#")]),t._v(" 缓存数据的存储")]),t._v(" "),s("p",[t._v("从"),s("RouterLink",{attrs:{to:"/frontend/internet/http-cache.html#缓存的拓扑结构"}},[t._v("缓存的拓扑结构")]),t._v("可以知道，缓存是可以存在浏览器，也可以存在代理服务器上的。")],1),t._v(" "),s("h3",{attrs:{id:"浏览器缓存"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存"}},[t._v("#")]),t._v(" 浏览器缓存")]),t._v(" "),s("p",[t._v("浏览器将资源分为主资源和派生资源，如 HTML 页面就是主资源，HTML中的图片或者脚本连接，则称为派生资源。当允许浏览器缓存时，派生资源可以被存在磁盘中，也可以存储在内存中。")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("磁盘缓存")]),t._v("： 当浏览器关闭后，数据依然存在。"),s("strong",[t._v("Status Code: 200  (from memory cache)")])]),t._v(" "),s("li",[s("strong",[t._v("内存缓存")]),t._v("：浏览器关闭后，数据消失。"),s("strong",[t._v("Status Code: 200  (from disk cache)")])])]),t._v(" "),s("p",[t._v("用一个简单的 html 页面作为示范："),s("a",{attrs:{href:"http://106.52.128.34:3001/demo/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("index.html"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("index.html")]),t._v(" "),s("div",{staticClass:"language-html line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-html"}},[s("code",[s("span",{pre:!0,attrs:{class:"token doctype"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),s("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("DOCTYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("test"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("http-equiv")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("Cache-Control"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("content")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("max-age=60000"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("b.js"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),s("span",{pre:!0,attrs:{class:"token script"}}),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text/css"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("c.css"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        index.html\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("./img/634&312.png"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br")])]),s("ol",[s("li",[t._v("首次访问：向服务器请求数据，正常返回数据并缓存，此时所有文件都是正常的 200 返回。")])]),t._v(" "),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-save-1.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-save-1.png")}})]),t._v(" "),s("ol",{attrs:{start:"2"}},[s("li",[t._v("第二次访问（仅刷新）：不同的文件的表现有差异")])]),t._v(" "),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-save-2.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-save-2.png")}})]),t._v(" "),s("ul",[s("li",[t._v("index.html - 304 Not Modified")]),t._v(" "),s("li",[t._v("b.js - 200 OK (from memory cache)")]),t._v(" "),s("li",[t._v("c.css - 200 OK (from disk cache)")]),t._v(" "),s("li",[t._v("test.png - 200 OK (from memory cache)")])]),t._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[t._v("关闭浏览器后再次访问")])]),t._v(" "),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-save-3.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-save-3.png")}})]),t._v(" "),s("p",[t._v("可以看到所有的文件都从磁盘中读取了")]),t._v(" "),s("h4",{attrs:{id:"浏览器缓存数据读取优先级"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器缓存数据读取优先级"}},[t._v("#")]),t._v(" 浏览器缓存数据读取优先级")]),t._v(" "),s("p",[t._v("三级缓存原理")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("先去内存看，如果有，直接加载")])]),t._v(" "),s("li",[s("p",[t._v("如果内存没有，择取硬盘获取，如果有直接加载")])]),t._v(" "),s("li",[s("p",[t._v("如果硬盘也没有，那么就进行网络请求")])]),t._v(" "),s("li",[s("p",[t._v("加载到的资源缓存到硬盘和内存")])])]),t._v(" "),s("h4",{attrs:{id:"小结-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小结-2"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),s("p",[t._v("一般图片和很少改动的文件会用 disk cache, js文件通常是 memory cache。")]),t._v(" "),s("h3",{attrs:{id:"代理服务器存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代理服务器存储"}},[t._v("#")]),t._v(" 代理服务器存储")]),t._v(" "),s("p",[t._v("nginx 可以通过配置 proxy_cache 进行缓存，具体配置请看 "),s("a",{attrs:{href:"http://nginx.org/en/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("h2",{attrs:{id:"nginx缓存控制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx缓存控制"}},[t._v("#")]),t._v(" nginx缓存控制")]),t._v(" "),s("p",[t._v("前端项目一般都使用 nginx 作为资源服务器，nginx 也可以作为一个代理缓存的服务器。")]),t._v(" "),s("p",[t._v("这几个例子是简单演示，更多的配置请看 nginx 官方文档: "),s("a",{attrs:{href:"http://nginx.org/en/docs/",target:"_blank",rel:"noopener noreferrer"}},[t._v("nginx"),s("OutboundLink")],1),t._v("。")]),t._v(" "),s("ul",[s("li",[t._v("nginx 默认开启 ETag 和 Last-Modified。"),s("a",{attrs:{href:"http://106.52.128.34:3001/demo/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("demo1"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticClass:"language-nginx line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("demo "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alias")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("static"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("demo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br")])]),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-nginx-1.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-nginx-1.png")}})]),t._v(" "),s("ul",[s("li",[t._v("使用 Cache-Control 控制缓存。"),s("a",{attrs:{href:"http://106.52.128.34:3001/store/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("demo2"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticClass:"language-nginx line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("store "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alias")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("static"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("store"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Cache"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control public"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("max"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("age"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expires")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-nginx-2.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-nginx-2.png")}})]),t._v(" "),s("ul",[s("li",[t._v("关闭所有缓存，每次访问都是正常的 200 请求。"),s("a",{attrs:{href:"http://106.52.128.34:3001/nostore/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("demo3"),s("OutboundLink")],1)])]),t._v(" "),s("div",{staticClass:"language-nginx line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nostore "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("alias")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("static"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("nostore"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭 ETag 验证")]),t._v("\n    etag off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭 Last-Modified 验证")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if_modified_since")]),t._v(" off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br")])]),s("a",{attrs:{"data-fancybox":"",href:t.$withBase("/internet-http-cache-nginx-3.png")}},[s("img",{attrs:{src:t.$withBase("/internet-http-cache-nginx-3.png")}})]),t._v(" "),s("h3",{attrs:{id:"常用配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#常用配置"}},[t._v("#")]),t._v(" 常用配置")]),t._v(" "),s("div",{staticClass:"language-nginx line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-nginx"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("demo "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("home"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("demo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_max_body_size")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("m"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v("  X"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Real"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("IP "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v("  REMOTE"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("HOST "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$remote_addr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v("  Host "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$host")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$server_port")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_set_header")]),t._v("  X"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Forwarded"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("For "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$proxy_add_x_forwarded_for")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# add_header Cache-Control max-age=0,no-cache;")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("f "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("demo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("a"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("zA"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Z"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("demo"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html last"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Cache-Control'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'max-age=0,no-cache'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expires")]),t._v(" off"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\.html$"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("add_header")]),t._v(" Cache"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("Control max"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("age"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("no"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("cache"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$request_filename")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\.(js|css|png|jpe?g|gif|webp)$"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("expires")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("72")]),t._v("h"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br")])]),s("h3",{attrs:{id:"浏览器刷新操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#浏览器刷新操作"}},[t._v("#")]),t._v(" 浏览器刷新操作")]),t._v(" "),s("p",[t._v("在浏览器中，通过不同的方式刷新页面会有不同的结果。")]),t._v(" "),s("h4",{attrs:{id:"普通刷新操作-正常刷新-使用缓存数据。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#普通刷新操作-正常刷新-使用缓存数据。"}},[t._v("#")]),t._v(" 普通刷新操作：正常刷新，使用缓存数据。")]),t._v(" "),s("ul",[s("li",[t._v("Enter 回车刷新 —— 此时 Expires 生效时，则读取缓存")]),t._v(" "),s("li",[t._v("F5 / ctrl + R —— 此时 Expires 无效，Last-Modified/ETag 生效")])]),t._v(" "),s("h4",{attrs:{id:"强制刷新操作-强制刷新并重新加载数据-此时请求头默认带有-cache-control-no-cache"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#强制刷新操作-强制刷新并重新加载数据-此时请求头默认带有-cache-control-no-cache"}},[t._v("#")]),t._v(" 强制刷新操作：强制刷新并重新加载数据，此时请求头默认带有 Cache-Control: no-cache")]),t._v(" "),s("ul",[s("li",[t._v("勾选了 disable cache")]),t._v(" "),s("li",[t._v("ctrl + shift + R")]),t._v(" "),s("li",[t._v("ctrl + F5")])]),t._v(" "),s("p",[t._v("浏览器刷新按钮可以选择是普通刷新还是强制刷新，默认是普通刷新。")]),t._v(" "),s("p",[s("strong",[t._v("参考文章：")])]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP 缓存"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://www.cnblogs.com/chenqf/p/6386163.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("彻底弄懂HTTP缓存机制及原理"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=n.exports}}]);